"use strict";angular.module("infernoApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).directive("linePlot",function(){return{link:function(t,n,o){t.$watch("graphPlots",function(t){var e={width:o.width,height:o.height,pad:"0",margin:{t:0,b:20,l:40,r:0}};Plotly.newPlot(n[0],t,e)},!0)}}}).directive("xwindow",["$window",function(i){return{link:function(t,e,n){function o(){console.log(i.innerWidth),t.width!==i.innerWidth&&(t.width=i.innerWidth,t.$digest()),t.height!==i.innerHeight&&(t.height=i.innerHeight,t.$digest())}t.width=i.innerWidth,t.height=i.innerHeight,angular.element(i).on("resize",o),t.$on("$destroy",function(){angular.element(i).off("resize",o)})},restrict:"A"}}]).directive("tooltip",["$compile","$sce",function(i,r){return{restrict:"A",scope:{content:"=tooltipContent"},link:function(e,t,n){e.displayTooltip=!1,e.updateTooltipOpacity=function(t){o.css({opacity:t,"max-width":340})},e.updateTooltipPosition=function(t,e){$(this);o.css({top:t+"px",left:e+"px"})},e.getSafeContent=function(t){return r.trustAsHtml(t)};var o=angular.element('<div ng-show="displayTooltip" id="tooltip">        \t<span ng-bind-html="getSafeContent(content)"></span>        </div>');angular.element('<div ng-show="displayTooltip" class="tooltip">        \t<span ng-bind-html="getSafeContent(content)"></span>        </div>');angular.element(document.querySelector("body")).append(o),t.on("mouseenter",function(t){e.displayTooltip=!0,e.$digest()}),t.on("mousemove",function(t){e.updateTooltipOpacity(.9),e.updateTooltipPosition(t.clientY-20,t.clientX+5)}),t.on("mouseleave",function(){e.displayTooltip=!1,e.$digest()}),i(o)(e)}}}]).directive("xtooltip",function(){return{restrict:"A",link:function(t,e,n){e.hover(function(){e.tooltip({html:"true",container:"body"}),e.tooltip("show")},function(){e.tooltip("hide")})}}}).directive("bs-tooltip",function(){return function(t,e,n){n.$observe("title",function(t){e.tooltip("destroy"),jQuery.trim(t)&&e.tooltip()}),e.on("$destroy",function(){e.tooltip("destroy"),delete n.$$observers.title})}}).config(["$routeProvider",function(t,e){t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/inferno/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/inferno/main",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/inferno/tx",{templateUrl:"views/tx.html",controller:"TxCtrl",controllerAs:"tx"}).when("/tx",{templateUrl:"views/tx.html",controller:"TxCtrl",controllerAs:"tx"}).when("/inferno/rx",{templateUrl:"views/rx.html",controller:"RxCtrl",controllerAs:"rx"}).when("/rx",{templateUrl:"views/rx.html",controller:"RxCtrl",controllerAs:"rx"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]),angular.module("infernoApp").filter("split",function(){return function(t){var e=t.split(/([!,.;?-])/g),n="",o="",i="";return e.forEach(function(t){if(n+=t,52<t.length){return n.split(/(that|where|which|when|who)/g).forEach(r),o+=i,void(n="")}((o+=t).endsWith("--")&&"-"==t||"?"==t||";"==t||"."==t||"!"==t||","==t)&&(o+="\n",n="")}),console.log("line_index:0"),o;function r(t){if("that"==t||"where"==t||"when"==t||"who"==t||"which"==t)return i+="\n ",void(i+=t);i+=t}}}).controller("MainCtrl",["$window","$scope","$location",function(t,r,e){this.test="testing mainController";var n,o,i=window.localStorage.getItem("scratches");(i=null)==i&&(i=[{id:0,check:!1,name:"Quotes",scratches:[{check:!1,name:"plotly"},{check:!1,name:"bollinger bands"}]},{id:1,check:!1,name:"Utility",scratches:[]}],localStorage.setItem("scratches",JSON.stringify(i)),i=window.localStorage.getItem("scratches")),r.scratches=JSON.parse(i),r.deleteScratch=function(t,e){console.log("delete "+t+" "+e);for(var n=r.scratches.findIndex(function(t){return t.id==r.page}),o=r.scratches[n].scratches,i=0;i<o.length;i++)console.log(o[i].name)},r.select=function(t){r.page=t.id,r.name=t.name,r.input=t.input,console.log("select "+r.name)},r.delete=function(t){console.log("delete "+t),r.scratches.splice(t,1),localStorage.setItem("scratches",JSON.stringify(r.scratches))},r.update=function(){var t=r.scratches.findIndex(function(t){return t.id==r.page});r.scratches[t].name=r.name,localStorage.setItem("scratches",JSON.stringify(r.scratches))},r.toggle=function(t){console.log("toggle"+t.id),t.check=!t.check,r.update()},r.add=function(){var t={name:r.addPageTitle,scratches:""};r.scratches.push(t),localStorage.setItem("scratches",JSON.stringify(r.scratches))},r.txTotalSymbols=localStorage.getItem("totalSymbols"),r.txTotalLHs=localStorage.getItem("totalLHs"),r.rxTotalSymbols=localStorage.getItem("rxTotalSymbols"),r.rxTotalLHs=localStorage.getItem("rxTotalLHs"),r.isActive=function(t){return t===e.path()},r.ie=(n=window.navigator.userAgent,0<(o=n.indexOf("MSIE"))?parseInt(n.substring(o+5,n.indexOf(".",o))):navigator.userAgent.match(/Trident\/7\./)?11:0)}]),angular.module("infernoApp").controller("AboutCtrl",["$scope","fileReader",function(t,e){t.isNullOrEmpty=function(t){return null==t||""===t}}]),angular.module("infernoApp").directive("xelement",["$timeout",function(r){return{restrict:"A",link:function(n,o,i){o.ready(function(){var t,e;r(function(){t=o[0].offsetHeight,e=o[0].offsetWidth,i.key?n[i.key]={height:t,width:e}:n.elementSize={height:t,width:e}})})}}}]).filter("myCantoFilter",function(){return function(t,e){var n=[];if(""==e)return t;var o=e.split(/[,:]/),i=o[0],r=o[1],l=o[2];return angular.forEach(t,function(t){null!=t.name&&t.name.trim()==i.trim()&&t.line>=r&&t.line<l&&n.push(t)}),n}}).filter("conto",function(){return function(t,e){var n=[];if(""==e)return n;var o=e.split(/[,:]/),i=o[0],r=o[1],l=o[2];return angular.forEach(t,function(t){t.conto==i&&t.line>=r&&t.line<=l&&n.push(t)}),n}}).controller("RxCtrl",["$scope","$http","$filter",function(a,t,e){a.opt=localStorage.getItem("myOpt"),null==a.opt&&(a.opt="pinsky",localStorage.setItem("myOpt",a.opt)),a.isNullOrEmpty=function(t){return null==t||""===t},a.comments=JSON.parse(localStorage.getItem("myComments"))||[],a.getFilteredComments=function(){return e("conto")(a.comments,1,1,9)},a.rxTotalSymbols=60,a.rxTotalLHs=1,a.myQuery=localStorage.getItem("myQuery"),a.isNullOrEmpty(a.myQuery)&&(a.myQuery="1:1,25",localStorage.setItem("myQuery",a.myQuery)),localStorage.setItem("rxTotalSymbols",a.rxTotalSymbols),localStorage.setItem("rxTotalLHs",a.rxTotalLHs);var r=0,l=[];a.cantoes=[];var s="",n="https://dsmarkchen.github.io/inferno/inferno.txt";"bang"==a.opt&&(n="https://dsmarkchen.github.io/inferno/infernobang.txt"),"pinsky"==a.opt&&(n="https://dsmarkchen.github.io/inferno/infernopinsky.txt"),t.get(n).then(function(t){a.inferno=t.data.split(/\r?\n/);for(var e=0;e<a.inferno.length;e++)a.buildone(a.inferno[e],e,!0);0<l.length&&a.cantoes.push({line:r-1,text:l.join("<br>")})});var c=3;a.move=function(){var t=a.myQuery;if(""!=t){var e=t.split(/[,:]/),n=e[0].trim(),o=parseInt(e[1].trim(),10),i=parseInt(e[2].trim(),10),r=i-o;if(0<c){i=i+r+1;var l=(o=o+r+1)%3;0==l&&(o+=1,i+=1),2==l&&(o-=1,i-=1)}c<0&&(o=o-r-1,i=i-r-1,0==l&&(o+=1,i+=1),2==l&&(o-=1,i-=1)),o<0&&(o=1),a.myQuery=n+":"+o.toString()+","+i.toString(),localStorage.setItem("myQuery",a.myQuery)}},a.prev=function(){c=-3,a.move()},a.next=function(){c=3,a.move()},a.buildone=function(t,e,n){var o=" ";if(n&&(o="<br>"),0<t.trim().length){if(/^##/.test(t))return 0<l.length&&(a.cantoes.push({name:s,line:r,text:l.join(o),visible:!0}),l=[]),s=t.replace(/^## /,""),void(r=0);var i=t.replace(/--/g,"&#x2012;");l.push(i.trim()),r++,3==l.length&&(a.cantoes.push({name:s,line:r-2,text:l.join(o),visible:!0}),l=[])}}}]),angular.module("infernoApp").controller("TxCtrl",["$http","$scope","$sce","fileReader",function(e,d,n,t){d.symbol=localStorage.getItem("mySym"),null==d.symbol&&(d.symbol="hod.to",localStorage.setItem("mySym",d.symbol)),d.opt=localStorage.getItem("myOpt"),null==d.opt&&(d.opt="30",localStorage.setItem("myOpt",d.opt)),d.changeDays=function(){localStorage.setItem("myOpt",d.opt)},d.isNullOrEmpty=function(t){return null==t||""===t},e.defaults.useXDomain=!0,d.getSymbol=function(){null==d.symbol&&(d.symbol="hod.to",localStorage.setItem("mySym",d.symbol)),localStorage.setItem("mySym",d.symbol),console.log("#### getSymbol:    "+d.symbol);var t="https://query1.finance.yahoo.com/v8/finance/chart/"+d.symbol;n.trustAsResourceUrl(t);e({url:t,method:"GET",params:{format:"jsonp",symbol:d.symbol,range:d.opt+"d",interval:"1d",indicators:"quote"},timeout:3e5,isArray:!1}).then(function(t){var e=JSON.stringify(t.data.chart.result);d.results=JSON.parse(e),d.quote=d.results[0].indicators.quote[0],d.timestamp=d.results[0].timestamp;var n=0,o=[],i=[],r=[],l=[],a=[];for(var s in d.quote.close)o.push(n),r.push(d.quote.open[s]),l.push(d.quote.high[s]),a.push(d.quote.low[s]),i.push(d.quote.close[s]),n++;var c={x:o,y:i,type:"scatter"};d.timestamp;d.graphPlots=[c],console.log(d.results)},function(t){console.log("####  finance.yahoo error: "+t)})},d.visible=!1}]).directive("ngFileSelect",function(){return{link:function(e,t){t.bind("change",function(t){e.file=(t.srcElement||t.target).files[0],e.getFile()})}}}).factory("fileReader",["$q","$log",function(o,t){t.log("fileReader");return{readAsText:function(t,e){var n=o.defer();return function(t,e){var n=new FileReader;return n.onload=function(t,e,n){return function(){n.$apply(function(){e.resolve(t.result)})}}(n,t,e),n.onerror=function(t,e,n){return function(){n.$apply(function(){e.reject(t.result)})}}(n,t,e),n.onprogress=function(t,e){return function(t){e.$broadcast("fileProgress",{total:t.total,loaded:t.loaded})}}(0,e),n}(n,e).readAsText(t),n.promise}}}]),angular.module("infernoApp").run(["$templateCache",function(t){t.put("views/about.html",' <div class="container"> <div xwindow> <p ng-if="width > 320">The device window is: [{{width}}, {{height}}].</p> <p> This is about view. </p> <ul> <li> inferno reading </li> <li> notes editing</li> </ul> </div> </div> '),t.put("views/main.html",'<div class="jumbotron jumbotron-fluid"> <div class="container"> <div class="block"> <h1 class="animated fadeInUp">Scratch</h1> <p class="animated fadeInUp">Your Notes</p> <div ng-hide="ie == 0"> <p class="animated fadeInUp">IE {{ie}}</p> </div> </div> </div> </div> <div class="container"> <div class="row"> <h3>Scratches</h3> </div> <div class="row"> <table class="table table-striped"> <tr> <th width="10%"> Status</th> <th width="40%"> Name</th> <th width="40%"> Scratch</th> <th width="10%"> Delete</th> </tr> <tr ng-repeat="ppp in scratches track by $index" tabindex="1" ng-click="select(ppp)"> <td><div class="checkbox"> <input type="checkbox" value="{{ppp.check}}" ng-model="ppp.check"></div> </td> <td> {{ppp.name}} </td> <td> <table> <tr> <th width="10%"> Check</th> <th width="40%"> Name</th> <th width="10%"> Delete</th> </tr> <tr ng-repeat="scratch in ppp.scratches"> <td> <input type="checkbox" value="{{scratch.check}}"> </td> <td> <input value="{{scratch.name}}">  </td> <td> <span ng-click="deleteScratch(scratch.name, ppp.name)"> x</span> </td> </tr> </table> </td> <td> <span ng-click="delete($index)"> x</span> </td> </tr> </table> </div> <div class="row"> <input ng-model="addPageTitle"> <button class="btn btn-primary" ng-click="add()">Add</button>  </div> <div class="row"> <div class="form-group"> <label for="updateTitle">Name:</label> <input ng-model="name"> <button ng-click="update()" class="button button-primary">Update</button> </div> </div> <div class="row"> <div xwindow> <p ng-if="width > 320">The device window is: [{{width}}, {{height}}].</p> </div> </div> </div> '),t.put("views/rx.html",'<div class="container"> <div class="row"> <div class="col-md-2 col-sm-12"> <div class="row"> <div class="col"> <form> <div class="form-group"> <div class="input-group"> <div class="input-group-addon"><i class="fa fa-search"></i></div> <input type="text" class="form-control" placeholder="query: start, end" ng-model="myQuery"> </div> </div> </form> </div> </div> <div class="row"> <div class="col"> <form> <button class="btn btn-secondary" ng-click="prev()"> prev</button> <button class="btn btn-secondary" ng-click="next()"> next</button> </form> </div> </div> </div> <div class="col-md-10 col-sm-12"> <div ng-repeat="canto in cantoes | myCantoFilter: myQuery  track by $index "> <div class="row" ng-if="canto.visible"> <div class="col-1" style="margin:0px 0px 0px 0px;padding:0px 0px; border: 1px solid #f8f9fa"> <p class="line" style="margin:0px 0px 0px 0px;padding:0px 0px;background-color:#f8f9fa">{{canto.name}}:{{canto.line}} </p> </div> <div class="col-11" style="padding-left:1px;padding-right:1px"> \x3c!--\r\n                  <div xelement>\r\n                    <p ng-if="elementSize.width > 100 && $index == 0" >The element width: {{elementSize.width}}.</p>\r\n                  </div>\r\n              --\x3e <p class="canto" style="background-color:lavender;margin-left:0;width:100%" ng-bind-html="canto.text"></p> </div> </div> </div> </div> </div> <div class="row"> <div class="col"> <br><br> <ul class="list-group list-group-flush"> <li class="list-group-item" ng-repeat="comment in comments  | conto: myQuery track by $index"> <i class="fa fa-caret-right" sytle="height:80px" tooltip tooltip-content="comment.comment"> {{comment.name}} </i> </li> </ul> </div> </div> </div> '),t.put("views/tx.html",'<div class="container"> \x3c!-- <div class="row">\r\n   <table>\r\n   <tr ng-repeat="result in results track by $index">\r\n        <td> currency: {{result.meta.currency}} </td> \r\n        <td> symbol: {{result.meta.symbol}} </td> \r\n   </tr>\r\n   </table>\r\n</div>\r\n--\x3e <div class="row"> <div class="col"> <input type="text" name="symbol" ng-model="symbol"> <button class="btn btn-primary" ng-click="getSymbol()">Get</button>  <code>text = {{symbol}}</code> </div> <div class="col"> <form> <label class="radio-inline"> <input type="radio" ng-model="opt" value="30" ng-change="changeDays()">Default (30) </label> <label class="radio-inline"> <input type="radio" ng-model="opt" value="556" ng-change="changeDays()">556 </label> <label class="radio-inline"> <input type="radio" ng-model="opt" value="1132" ng-change="changeDays()">1132 </label> <tt>opt = {{opt}}</tt><br> </form> </div> </div> <div class="row"> <div class="col"> <table class="table table-striped"> <tr> <th>Date</th> <th>Open</th> <th>High</th> <th>Low</th> <th>Close</th> </tr> <tr ng-repeat="close in quote.close track by $index"> <td> {{timestamp[$index] * 1000 | date: \'yy-MM-dd\'}} </td> <td> {{quote.open[$index] | number:1}} </td> <td> {{quote.high[$index] | number:1}} </td> <td> {{quote.low[$index] | number:1}} </td> <td> {{quote.close[$index] | number:1}} </td> </tr> </table> </div> <div class="col"> <line-plot graph-plots="graphPlots" width="600" height="400"></line-plot> \x3c!-- <line-plot width=600, height=400>  --\x3e </div> </div> \x3c!--\r\n   <b>Statistics:</b><br />\r\n\r\n    <table class="table table-striped">\r\n     <tr>\r\n        <th>Name</th>\r\n        <th>Counts </th>\r\n     </tr>\r\n     <tr> \r\n        <td>Total Symbols </td>\r\n        <td>{{totalSymbols}}</td>\r\n     </tr>\r\n     <tr> \r\n        <td>Total Sequences </td>\r\n        <td>{{totalLHs}}</td>\r\n     </tr>\r\n    </table>\r\n   \r\n   <b>Preview:</b> \r\n   <input ng-model="visible" type="checkbox"/>\r\n   <br />\r\n   <i ng-hide="textSrc">No text file choosed</i>\r\n   <pre ng-show="visible">{{textSrc}}</pre>\r\n   \r\n   <br/> \r\n   <b>Progress:</b>\r\n  <progress value="{{progress}}"></progress>\r\n</div>\r\n--\x3e </div>')}]);